In the past decade, Wi-Fi has emerged as one of the most commonly used technologies in providing high speed internet access to mobile devices such as smartphones, tablets and laptops in public and private spaces \citep{torrens2008}.
This has resulted in multiple Wi-Fi networks being available at almost every location in dense urban environments.
Traversing through this overlapping mesh of Wi-Fi networks, modern mobile devices with Wi-Fi network interfaces regularly broadcast a special type of signal known as `Probe Requests' in order to discover the Wi-Fi networks available to them.
This helps these devices to connect and switch between the Wi-Fi networks seamlessly.

Probe requests are low level signals standardised by IEEE 802.
1 specification \citep{ieee2016} for service discovery, and are implemented in any Wi-Fi capable device irrespective of the manufacturer or the model.
This ubiquity and standardisation makes them an excellent source of open, passive, continuous, and wireless data generated by Wi-Fi capable devices present at any given time and location.
Considering the unprecedented levels of mobile device ownership in recent years, we can, in turn use this data to understand the population distribution in highly dynamic urban environments with high spatial and temporal granularity \citep{freud2015, konto2017}.
While a Wi-Fi based method to collect data offers us various advantages such as, easy scalability and efficiency in terms of cost and time, it also introduces few systematic biases and uncertainties in the collected data along with the serious risk of infringing on the privacy of the mobile users.
In this section, using the set of probe requests and manual counts collected at various high street locations across London, we demonstrate that pedestrian footfall at these locations can be estimated with considerable precision and accuracy while protecting the privacy of the pedestrians.

Unlike GPS, the location of the Wi-Fi enabled mobile device cannot be directly inferred from Wi-Fi, however there are reliable methods to triangulate the location of mobile devices from the locations of known access points (AP) and the signal strength reported by them \citep{he2003, moore2004, lamarca2005}.
This can overcome the usual shortcoming of GPS, which struggles for precision and accuracy in indoor and densely built environments \citep{zarim2006, kawaguchi2009, xi2010}.
Utilising this, we can easily and quickly estimate trajectories of the mobile devices \citep{musa2012} which can be used similarly to the GPS trajectories to understand individual travel patterns \citep{rekimoto2007, sap2015}, crowd behaviour \citep{abedi2013, mowafi2013}, vehicular \citep{lu2010} and pedestrian movement \citep{xu2013, fukuzaki2014, wang2016}.
Such data can also be used in transportation planning and management to estimate travel time \citep{musa2011} and real time traffic monitoring \citep{abbott2013}.
Using techniques demonstrated by \citep{franklin2006} and \citep{pang2007}, along with information present in the probe requests, one can even model interactions between the users \citep{cheng2012, barbera2013, cunche2014} such as predicting which of them are most likely to meet again \citep{cunche2012}.
Using the semantic information present in these probe requests it even is possible to understand the nature of population at a large scale \citep{di2016}
.

Although extensive research has been carried out on this subject with feasible and favorable results, in recent years, one of the major challenges faced in such attempts has been the increasing attempt by mobile phone manufacturers to protect their usersâ€™ privacy by anonymising the globally identifiable portion of the probe requests \citep{greenstein2008}.
Various methods have been devised to overcome this anonymisation process such as estimating the device model information from a known dataset of manufacturers and device behaviours \citep{martin2016}; Scrambler attack using a small part of the physical layer specification for Wi-Fi \citep{vo2016, bloessl2015}; and timing attack where the packet sequence information along with information elements present in the probe request frame is used \citep{matte2016, cheng2016}. A combination of these methodologies has been proven to produce de-anonymised globally unique device information \citep{vanhoef2016, martin2017}. These approaches usually result in serious risk of breach of privacy of the users of the mobile devices by revealing their identifiable personal information.

There is a clear gap in the research for exploring methodologies for estimating the number of unique mobile devices from a set of anonymised probe requests, without the need to reveal their original device information.
Such a technique has various applications such as uncovering the urban wireless landscape \citep{rose2010}, revealing human activity at large scales \citep{qin2013}, estimating pedestrian numbers in crowds \citep{schauer2014, fukuzaki2015}, and even counting people in hyper local scales such as queues \citep{wang2013}.
With enough infrastructure to collect such information we can even aim to generate a real-time census of the city \citep{konto2017}.
With this background, we set out to devise and implement a methodology to reliably estimate human activity such as pedestrian footfall from Wi-Fi probe requests without risking a breach of privacy of the users involved. 

\vspace{1.5em}\noindent\textit{Methodology}\vspace{0.5em}

The primary aim of this research was to enable us to collect a series of probe requests and process them into a usable pedestrian footfall count.
We did this by using a Wi-Fi receiver to collect probe requests broadcast by mobile devices, filtering out the background noise, and aggregating them based on the device that generated them.
In this section, we examine the characteristics of probe requests in detail, devise a methodology to collect these probe requests in public areas, examine the systemic biases and uncertainties in the data collection method, and devise data processing methods to overcome these challenges.
Finally, we compare the processed footfall counts to the ground truth recorded by primary surveys.

Probe requests are a special type of management packet broadcast by Wi-Fi enabled devices as part of their various functions such as scanning for available APs and quick geolocation by triangulation based known APs, etc.
These are broadcast by all Wi-Fi enabled devices regardless of the manufacturer, type or model of the devices, although there is some variation in the frequency and the content of the information transmitted through them.
In some cases, such as Android devices, these are broadcast even when the Wi-Fi functionality has been turned off by the user so that the device can immediately connect to networks when the functionality is switched back on.
Since some devices even use the probe requests as a less accurate form of localisation, they continuously send probe requests when Wi-Fi has been switched off.
Thus, these signals can be used to reliably identify the presence of Wi-Fi enabled mobile devices.
Being a first step of connection initiated by the mobile device, these packets have information regarding the characteristics of the mobile device itself.
Some of the key information we can infer from these requests are,

\begin{enumerate} 
\item \textbf{Media Access Control (MAC) address} which is a name identifying the wireless hardware of the mobile device, 
\item \textbf{Sequence number} of the request for the mobile device to keep track of the responses, 
\item \textbf{Time stamp} at which the request was received by the AP, 
\item Total \textbf{length} of the request in number of bits, and 
\item The \textbf{strength of the signal} received by the mobile device.
\end{enumerate}

The MAC address is the primary identifier for the mobile device and has two parts.
The first part is the Organisationally Unique Identifier (OUI) which provides information about the manufacturer of the device and the second part is the identifier for the device.
In modern devices, to protect users' privacy, the second part of the MAC address can also be randomised and hence may not be unique to devices.
When the MAC address is randomised, it is marked as such by setting a specific bit in the probe request packet as 1.
Although sequence number of the packet is strictly unique to a mobile device, we hypothesize that we can use them to estimate the number of unique devices as demonstrated by \citep{vanhoef2016}; where optional information present in the probe requests - Information Elements (IE) along with the sequence numbers, have been used to fingerprint the devices.
This approach has become increasingly difficult as mobile phone manufacturers have severely limited the IEs present in the probe requests thus leading us to explore methods which use only the sequence numbers.
This also affects the established commercial solutions using Wi-Fi probe requests such as Blix, Walkbase, Euclid Analytics, RetailNext etc.
There has been another solution proposed by \citep{hong2018} where the authors tried to solve the similar problem using a hidden markov models based trajectory inference algorithm but the scope of this research was limited to enclosed, exit controlled public spaces such as shopping malls, railway stations, etc.

Data collection was done with the help of custom sensors built from modifying the hardware used in Smart Street Sensors \citep{sss2016} and updating them with custom software.
The sensor is essentially a Raspberry-Pi device with Wi-Fi and 3G modules.
It keeps the Wi-Fi module in `Monitor mode' and uses the open source software - Wireshark \citep{wireshark2} to passively collect all packets sent to `broadcast', marked with type as `management', and subtype `probe requests'.
The MAC address in these probe requests is obfuscated at the device level using a cryptographic hashing algorithm and transmitted through 3G connection to a central database via web-sockets protocol, where it is stored in a PostgreSQL database for further analysis.
The random salt used in the hashing algorithm was rotated regularly to further mitigate the risk of de-anonymisation of the hash.
Though hashing cannot completely ensure anonymisation as discussed in \citep{demir2014}, it can sufficiently obfuscate the data; which along with a secure process of data handling, gives us reasonable security.
An overall schematic of the data collection and storage process is shown in Figure \ref{datacollection_schematic}.
The ground truth on the number of pedestrian footfall was recorded using a custom Android application - Clicker \citep{bala2018}.
This app logs accurate timestamps each time the surveyor records a pedestrian crossing the designated cordon line at the location.
In addition to counting the pedestrians manually, this procedure results in the device broadcasting probe requests regularly, which in turn, gives us a `known device' to calibrate our methodology against.


% \begin{figure} 
% 	\centering \includegraphics[width=\linewidth]
% 		{images/figure_1.jpeg}
% 	\caption 
% 		{Schematic diagram showing the process of collecting and storing probe
% 		requests using the sensor}
% 	\label{datacollection_schematic} 
% \end{figure}

After collecting data, we began estimating the footfall or pedestrian activity from them by identifying the following potential uncertainties arising from our data collection method:

\begin{enumerate} 
  \item \textbf{Background noise} - since the extent to which Wi-Fi signals travel differs subject to various factors such as interference and humidity, it is close to impossible to restrict our data collection to a finite area of interest.
  This can lead to a significant background noise at certain locations.
  For example, a phone shop or a bus stop located next to the study area can artificially increase the number of probe requests received by the sensor.
  It is important to note that this method may not work effectively on study locations with complex configurations such as the source of noise and the area of study being located at the same distance from the sensor.
  This aspect is explored in detail in the broader case study in the following sections.
  \item \textbf{MAC randomisation} - mobile devices in recent years have been using randomised `local' MAC addresses for probe requests to protect the users from being tracked.
  This makes it impossible to tell if the probe requests are being sent by the same mobile device. This along with the previous problem can further increase the magnitude of error by several fold.
  \item \textbf{Mobile ownership} - since the rate of mobile ownership can vary widely across geography and demography, we cannot assume that every mobile device translates to one pedestrian footfall.
  In addition to this, there is a long term overall increase in mobile ownership which may affect the number of probe requests collected overtime.
\end{enumerate}

