\chapter{Collecting the Data}

As we saw in the literature search Wi-Fi as a technology is well suited for research into human mobility.
In this chapter we evaluate the technology in detail and devise a methodology to
measure the most possible amount of information from from Wi-Fi.
The data is defined by the IEEE standard.
We start by looking at the standard in detail.
Then we devise simple experiments to collect sample data.
Then we expand the experiments to include locations across London to collect more data.
Finally we give a detailed description of the methodology of the Smart Street Sensor project and the data collected from it.

\section{Wi-Fi as a Source of Data}

Wi-Fi is ubiquitous.
The smart-phone adoption rates are growing.
All smart-phones try to connect to internet.
In addition to mobile networks, Wi-Fi is the second most common way they connect to internet.
Most places provide Wi-Fi as the way to connect to internet.
Unlike mobile networks Wi-Fi is a general purpose service.
There are multiple networks across locations hence the phones are made to be able to move across networks seamlessly.
The mobile phone initiates the contact.
It sends a special signal called - Probe Requests.
This has information about the mobile device.
The router replies with a signal called Probe response.
This forms a digital handshake between these devices.
The devices then carry on with authentication and talking to each other.
After authentication the connection is encrypted and private.
But the probe request process is unencrypted and open.
The probe request is sequential signal which is defined in IEEE standards.
The table shows All possible information that can be included in a probe request.
The figure shows the structure of a probe request.
This is a stream of data broadcast over air from all the phones around a area. 

The probe request frame is the signal sent by a WiFi capable device when it needs to obtain information from another WiFi device.
For example, a smartphone would send a probe request to determine which WiFi access points are within range and suitable for connection.
On receipt of a probe request, an access point sends a probe response frame which contains its capability information, supported data rates, etc.
This ‘request-response’ interaction forms the first step in the connection process between these devices.
The structure of a probe request is shown in Figure 3.3.
We can observe that the request frame has two parts, a MAC header part which identifies the source device and frame body part that contains the information about the source device.
The information that can be included in a probe request shown in Table 3.2.
As mentioned earlier, the SmartStreetSensor collects some of the information present in probe request frame relayed by mobile devices, along with the time interval at which the request was collected and the number of such requests collected during that interval.
The actual information present in the data collected by the SmartStreetSensor is shown in the Table 3.3.

\section{Initial Experiments}

First setup using the laptop and wireshark in the living room.
Second set of experiments in UCL cloisters.
To start, we designed a small pilot study to validate the filtering and clustering methodology against the scale and complexity of data collected in an open public area such as a retail high street.
We also aimed to find the algorithm which was best suited for the classification of signal strengths as 'low' and 'high' in order to filter out the background noise.
The data was collected at Oxford Street, London on 20 December 2017 from 12:30 to 13:00 hrs, Wi-Fi probe requests were collected using the sensor described in Section and pedestrian footfall was manually recorded using the Android app - Clicker bala2018clicker.
Being located at one of the busiest retail locations in the United Kingdom, the Wi-Fi sensor captured approximately 60,000 probe requests during the half hour period; 3,722 people were manually recorded walking on the pavement during that time.
The surveyor positioned himself at the front of a store while carrying the sensor in a backpack and counted people walking by the store on the pavement (3m wide approximately) using a mobile phone.
The sensor was kept as close to the store window as possible, and the manual count was done as a cordon count in front of the store.

\section{Pilot Study}

The methodology set out above was implemented in five different Central London locations at different times.
Sensors were installed and data collected for extended periods of time.
We also carried out manual counting at these locations across different times of the day.
We then applied the methodologies discussed earlier to arrive at estimated pedestrian footfall and compared them with the corresponding manual counts.
We finally evaluated the effectiveness of the processes with the Mean Absolute Percentage Error (MAPE) at the locations and report our findings below.

\begin{table}
    \caption{Locations where sensors were installes, volume and speed of probe
    requests collected by the sendor and total pedestrians manually counted. The data occupies around 1.8 GB on disk when encoded in text format.}
    {\begin{tabular}{clllccc} 
     ID & Location & Type & Installation notes & Probe Requests & Footfall\\
     & & & & x10\textsuperscript{6} (per min) & No. (per min)\\
     1 & Camden High Street & Phone Shop & Bus stop in front & 9.9 (297) & 3683 (33)\\
     2 & Central St.Giles & Restaurant & Seating area on both sides & 3.9 (169) & 0346 (05)\\
     3 & Holborn Station & Info. Kiosk & Overlooks station entrance & 4.3 (303) & 2956 (46)\\
     4 & Brunswick Center & Fast Food & Has seating area on one side & 3.4 (210) & 0960 (12)\\
     5 & The Strand & Tea Shop & Has phone shop next door & 8.4 (382) & 1969 (21)\\
    \end{tabular}}
    \label{locations-table}
\end{table}

The locations at which the data were collected are shown in Table .
The locations were chosen for their diverse site conditions and unique sources of noise around the potential location of the sensors.
The position of the sensor at these locations with respect to the context is shown the Figure 
We can see that Location 5 is the `cleanest' with one clear stationary source of noise (phone shop) while location 2 is the most complex due to the proximity of seating areas to the sensor.
The sensors were operational through out February and March, while manual counts were conducted in these locations in half hour sessions on at least two different days.
For the purposes of comparing with ground truth, we considered the data from sensors which correspond to the 12 sets of available manual counts.
The schedule of data collection is shown in Figure .


\section{Smart Street Sensor Project}

The SmartStreetSensor project is one of the most comprehensive study carried out on consumer volume and characteristics in retail areas across UK.
The project has been organised as a collaboration between Local Data Company (LDC) and Consumer Data Research Centre,  University College London (CDRC, UCL).
The data for the study is generated independently within the project through sensors installed at around 1000 locations across UK.
When completed, the project will serve as the first and unique comprehensive research into the patterns of retail activity in UK high streets.

As a first step, various locations for the study were identified by CDRC to include a wide geographical spread, different demographic characteristics and range of retail centre profiles.
A custom footfall counting technology using WiFi based sensors was also designed, developed by LDC and the sensors were installed the identified locations.
The sensor monitors and records signals sent by WiFi enabled mobile devices present in its range.
In addition, the number of people walking by the sensor was counted manually for short time periods during the installation.
The project aims to combine these two sets of data to use as a proxy for estimating footfall at these locations.
The potentially identifiable information collected on the mobile devices is hashed at sensor level and the data is sent to central server via encrypted channel for storage.
This data is then retrieved securely for the preparation of the commercial dashboards by LDC and for research purposes by CDRC users.
The project began on July 2015 with the first sensor installation and has grown to an average of 450 daily active sensors as of January 2017.

The primary aim of the project is to improve our understanding of the dynamics of the high street retail in UK.
As we saw in our literature search, unlike online retail, this involves quantification and measurement of human activity at small scales, such as high streets which already the subject of active research.
The key challenge in this area is the collection of data at smallest scales possible with minimal resources while not infringing on people’s privacy.
This challenge when solved can provide immense value to occupiers, landlords, local authorities, investors and consumers within the retail industry.
The project aims to facilitate decision making by stakeholders in addition to the tremendous opportunities for academic research.

The data is collected through set of SmartStreetSensors (shown in Figure 3.1), a WiFi based sensor which when installed acts as a WiFi access point and collects specific type of packets (probe requests) relayed by mobile devices which are which are within the device’s signal range and are searching for available access points.
The sensor is usually installed on partnering retailer's shop windows so that its range covers the pavement in front of the shops.
The installation and calibration of device with respect to the shop window and the pavement is illustrated in Figure 3.2.
There is also a small percentage (3\%) of the devices which are installed within large shops to monitor internal footfall.
Each device collects data independently and uploads the collected data to a central container at regular interval 5 minutes through a dedicated 3G mobile data connection.
The sensor hardware has been improved over the course of the project and currently has built in failure prevention mechanisms such as, backup battery for power failures, automatic reboot capabilities and in-device memory for holding data when internet is not available.
The hardware versions and the corresponding features are detailed in Table 3.1.

\section{Uncertainties in Data}

Having set up the data collection process, organised the data for quick and easy retrieval and satisfied with the consistency of the data collection infrastructure, the next step is the identification of further uncertainties in the data and formation of informed assumptions to move forward with the analysis.
The major source of uncertainties we encounter and assumptions we undertake are as follows:

Range of the sensor: Since the strength of the signal from a mobile device to the WiFi access point depends on various factors such as distance between them, the nature and size of obstructions between them, interference from other electromagnetic devices etc., the exact delineation of the range of the sensors is almost to impossible.
Moving forward in the research we assume that the range of the sensor is equal in all directions and is linearly indicated by the RSSI (received signal strength indicator) reported by the mobile devices in range.

Probe request frequency: The frequency of probe requests generated by device varies widely based on the manufacturer, operating system, state of the device and the number of access points already known to the device as illustrated in Figure 3.9 and 3.10 (Freudiger, 2015).
These requests are also generated in short bursts rather than at regular intervals.
Moreover android devices send probe requests even when the WiFi is turned off.
With the large number of different devices available, it is impossible to predict and create a general model for this probing behaviour.
For simplicity, we assume that for a probe request received which has a MAC address with a known OUI, there is a corresponding device present within the range of the sensor at that time interval, irrespective of the number of such requests received in the mentioned interval.
Essentially we are just looking for unique MAC addresses within a time period rather than the total number requests made by them.

MAC address collisions: From the initial analysis we have observed that there are few instances of MAC address collisions reported where a device known to be in some place has been reported somewhere else.
This might be occurring due to rogue MAC randomisation by certain devices and the hashing procedure done at two different places.
Due to the negligible volume of such collisions (~2\%), for the purpose of this report, we ignore these collisions and treat all distinct hashed MAC addresses with know OUID to be the same device.

\section{Discussion}
